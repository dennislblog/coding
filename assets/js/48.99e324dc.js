(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{1259:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("div",{staticClass:"custom-block tip"},[n("p",[t._v("这里记录模拟器的制作, 母版是"),n("a",{attrs:{href:"https://github.com/Surbeivol/PythonMatchingEngine",target:"_blank",rel:"noopener noreferrer"}},[t._v("PythonMatchingEngine @ Surbeivol"),n("OutboundLink")],1)])]),t._v(" "),n("h2",{attrs:{id:"数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据"}},[t._v("#")]),t._v(" 数据")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("高频订单数据(包括6列)")]),t._v(" "),n("blockquote",[n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"right"}},[t._v("ordtype(str)")]),t._v(" "),n("th",{staticStyle:{"text-align":"left"}},[t._v("订单类型")]),t._v(" "),n("th",{staticStyle:{"text-align":"right"}},[t._v("new/cancel/modif")]),t._v(" "),n("th",{staticStyle:{"text-align":"left"}},[t._v("新订单, 取消订单和修改订单")])])]),t._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"right"}},[t._v("uid(int)")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("订单编号")]),t._v(" "),n("td",{staticStyle:{"text-align":"right"}},[t._v("history/user")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("历史订单编号是正数, 策略订单编号是负数")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"right"}},[t._v("is_buy(bool)")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("买/卖单")]),t._v(" "),n("td",{staticStyle:{"text-align":"right"}},[t._v("qty(int)")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("订单量")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"right"}},[t._v("price(float)")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("限价单价格")]),t._v(" "),n("td",{staticStyle:{"text-align":"right"}},[t._v("timestamp(datetime64)")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("精确到秒后面那个单位")])])])]),t._v(" "),n("ul",[n("li",[t._v("之所以用不同编号区分历史订单和策略订单, 是用来记录策略VWAP和市场VWAP或者累计交易量")])])]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("        ordtype uid     is_buy  qty price   timestamp\n0       new     55      False   3   95.80   2019-05-23 09:00:30.216\n1       new     56      False   32  95.90   2019-05-23 09:00:30.216\n2       new     57      False   1   96.15   2019-05-23 09:00:30.216\n...\n27054   cancel  13657   NaN     131 NaN     2019-05-23 17:30:00.016\n27055   cancel  13658   NaN     432 NaN     2019-05-23 17:30:00.016\n")])])])]),t._v(" "),n("h2",{attrs:{id:"订单薄"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#订单薄"}},[t._v("#")]),t._v(" 订单薄")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("价格-时间双向优先队列")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\nob.get_new_price(10, -1) => ind = index(10) - 1 => return price @ ind\n"""')]),t._v("\nob "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Orderbook"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ticker"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'san'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nob"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("send"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uid"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" is_buy"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" price"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nob"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("send"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uid"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" is_buy"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" price"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nob"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("send"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uid"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" is_buy"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" price"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nob"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("send"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uid"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" is_buy"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("70")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" price"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ob"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_new_price"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nob"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("send"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uid"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" is_buy"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" price"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ob"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_new_price"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nob"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("send"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uid"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" is_buy"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" price"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ob"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_new_price"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nob"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("send"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uid"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" is_buy"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" price"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ob"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_new_price"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("blockquote",[n("p",[t._v("生成下面这个图(后面四个单的价格是根据流动性决定的), 如果一个订单价格价格在"),n("code",[t._v("ob.bbid")]),t._v("于"),n("code",[t._v("ob.bask")]),t._v("之间的话, 会触发立即交易(即市场单交易)\n"),n("img",{attrs:{src:a(709)+"#center",alt:""}})])]),t._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[t._v("代码")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" is_buy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" price"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" uid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" is_mine"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" timestamp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("datetime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('""" \n        首先如果订单不是历史订单, 价格就要相应作出调整(考虑到市场影响)\n        然后看是否价差相交, 可以直接匹配交易还是加到订单薄的某个位置\n    """')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" is_mine"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("market_impact "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            nticks "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("min")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("resilience"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("market_impact"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                         self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("max_impact"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            price "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_new_price"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("price"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("price"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" n_moves"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nticks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("elif")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("market_impact "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            nticks "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("max")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("resilience"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("market_impact"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                         "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("max_impact"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            price "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_new_price"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("price"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("price"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" n_moves"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nticks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("n_my_orders "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("my_cumvol_sent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" qty\n\n    neword "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" is_buy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" price"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" timestamp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_orders"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("update"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("uid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" neword"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("neword"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("leavesqty "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_is_aggressive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("neword"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_sweep_best_price"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("neword"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_bids"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("neword"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("or")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_asks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("neword"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])]),t._v(" "),n("h2",{attrs:{id:"模拟器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#模拟器"}},[t._v("#")]),t._v(" 模拟器")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("注入历史订单, 提交自己的订单和历史价格互动")]),t._v(" "),n("blockquote",[n("p",{staticClass:"katex-block"},[n("span",{staticClass:"katex-display"},[n("span",{staticClass:"katex"},[n("span",{staticClass:"katex-mathml"},[n("math",{attrs:{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"}},[n("semantics",[n("mrow",[n("mrow",[n("mi",{attrs:{mathvariant:"bold"}},[t._v("l")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("a")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("t")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("e")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("n")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("c")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("y")])],1),n("mo",[t._v("=")]),n("mrow",[n("mi",{attrs:{mathvariant:"bold"}},[t._v("m")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("d")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("l")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("a")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("t")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("e")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("n")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("c")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("y")])],1),n("mo",[t._v("+")]),n("mrow",[n("mi",{attrs:{mathvariant:"bold"}},[t._v("a")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("l")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("g")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("o")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("l")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("a")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("t")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("e")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("n")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("c")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("y")])],1),n("mo",[t._v("+")]),n("mrow",[n("mi",{attrs:{mathvariant:"bold"}},[t._v("o")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("b")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("l")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("a")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("t")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("e")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("n")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("c")]),n("mi",{attrs:{mathvariant:"bold"}},[t._v("y")])],1)],1),n("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("\\mathbf{latency} = \\mathbf{md latency} + \\mathbf{algo latency} + \\mathbf{ob latency}\n")])],1)],1)],1),n("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[n("span",{staticClass:"base"},[n("span",{staticClass:"strut",staticStyle:{height:"0.8888799999999999em","vertical-align":"-0.19444em"}}),n("span",{staticClass:"mord"},[n("span",{staticClass:"mord mathbf"},[t._v("l")]),n("span",{staticClass:"mord mathbf"},[t._v("a")]),n("span",{staticClass:"mord mathbf"},[t._v("t")]),n("span",{staticClass:"mord mathbf"},[t._v("e")]),n("span",{staticClass:"mord mathbf"},[t._v("n")]),n("span",{staticClass:"mord mathbf"},[t._v("c")]),n("span",{staticClass:"mord mathbf",staticStyle:{"margin-right":"0.01597em"}},[t._v("y")])]),n("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2777777777777778em"}}),n("span",{staticClass:"mrel"},[t._v("=")]),n("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2777777777777778em"}})]),n("span",{staticClass:"base"},[n("span",{staticClass:"strut",staticStyle:{height:"0.8888799999999999em","vertical-align":"-0.19444em"}}),n("span",{staticClass:"mord"},[n("span",{staticClass:"mord mathbf"},[t._v("m")]),n("span",{staticClass:"mord mathbf"},[t._v("d")]),n("span",{staticClass:"mord mathbf"},[t._v("l")]),n("span",{staticClass:"mord mathbf"},[t._v("a")]),n("span",{staticClass:"mord mathbf"},[t._v("t")]),n("span",{staticClass:"mord mathbf"},[t._v("e")]),n("span",{staticClass:"mord mathbf"},[t._v("n")]),n("span",{staticClass:"mord mathbf"},[t._v("c")]),n("span",{staticClass:"mord mathbf",staticStyle:{"margin-right":"0.01597em"}},[t._v("y")])]),n("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2222222222222222em"}}),n("span",{staticClass:"mbin"},[t._v("+")]),n("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2222222222222222em"}})]),n("span",{staticClass:"base"},[n("span",{staticClass:"strut",staticStyle:{height:"0.8888799999999999em","vertical-align":"-0.19444em"}}),n("span",{staticClass:"mord"},[n("span",{staticClass:"mord mathbf"},[t._v("a")]),n("span",{staticClass:"mord mathbf"},[t._v("l")]),n("span",{staticClass:"mord mathbf",staticStyle:{"margin-right":"0.01597em"}},[t._v("g")]),n("span",{staticClass:"mord mathbf"},[t._v("o")]),n("span",{staticClass:"mord mathbf"},[t._v("l")]),n("span",{staticClass:"mord mathbf"},[t._v("a")]),n("span",{staticClass:"mord mathbf"},[t._v("t")]),n("span",{staticClass:"mord mathbf"},[t._v("e")]),n("span",{staticClass:"mord mathbf"},[t._v("n")]),n("span",{staticClass:"mord mathbf"},[t._v("c")]),n("span",{staticClass:"mord mathbf",staticStyle:{"margin-right":"0.01597em"}},[t._v("y")])]),n("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2222222222222222em"}}),n("span",{staticClass:"mbin"},[t._v("+")]),n("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2222222222222222em"}})]),n("span",{staticClass:"base"},[n("span",{staticClass:"strut",staticStyle:{height:"0.8888799999999999em","vertical-align":"-0.19444em"}}),n("span",{staticClass:"mord"},[n("span",{staticClass:"mord mathbf"},[t._v("o")]),n("span",{staticClass:"mord mathbf"},[t._v("b")]),n("span",{staticClass:"mord mathbf"},[t._v("l")]),n("span",{staticClass:"mord mathbf"},[t._v("a")]),n("span",{staticClass:"mord mathbf"},[t._v("t")]),n("span",{staticClass:"mord mathbf"},[t._v("e")]),n("span",{staticClass:"mord mathbf"},[t._v("n")]),n("span",{staticClass:"mord mathbf"},[t._v("c")]),n("span",{staticClass:"mord mathbf",staticStyle:{"margin-right":"0.01597em"}},[t._v("y")])])])])])])]),t._v(" "),n("ul",[n("li",[t._v("md_latency, 查询最优价格花费的时间")]),t._v(" "),n("li",[t._v("algo_latency, 算法执行和提交订单的时间")]),t._v(" "),n("li",[t._v("ob_latency, 物理延迟, 包括路由带宽和离交易所的距离等")])])]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("gtw "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Gateway"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ticker"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'san'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" date"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("datetime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("date"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n        start_h"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" end_h"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  latency"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("20_000"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认市场影响20, 韧性1")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""将产生下面这个订单薄\n     vbid    pbid    pask   vask\n0   12682  4.0255  4.0265   6907\n1    6896  4.0250  4.0275   4000\n2    2500  4.0240  4.0285   6907\n3    1355  4.0230  4.0310  12992\n4   17850  4.0210  4.0340  72965\n5    7000  4.0205  4.0365  16625\n6  104505  4.0200  4.0390    999\n7     248  4.0190  4.0400  32265\n8    5000  4.0170  4.0410  13442\n9      60  4.0160  4.0450  15550\n"""')]),t._v("\n")])])]),n("h3",{attrs:{id:"处理订单"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#处理订单"}},[t._v("#")]),t._v(" 处理订单")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tick")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n    如果我的订单在下一个历史订单之前到达, 先处理我的订单\n        vol_in_queue: 队列里有多少交易量待执行?\n    否则直接\n    """')]),t._v("\n    oborder "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hist_orders"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ob_idx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下一个历史订单")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("my_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("timestamp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" oborder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("col_idx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'timestamp'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        my_order "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("my_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("popleft"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果my_queue不为空的话")]),t._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_send_to_orderbook"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("my_order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" is_mine"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n    self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_send_to_orderbook"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oborder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" is_mine"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("_send_to_orderbook")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" is_mine"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""发送新订单/修改/取消订单\n       \n        首先看是否还在模拟器结束时间之前, 更新ob_time\n        然后提交不同订单行为给订单薄\n    """')]),t._v("\n    ord_type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" timestamp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("col_idx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ordtype'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("col_idx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'timestamp'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" ord_type "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"new"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ob"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("send"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("is_buy"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("col_idx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'is_buy'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("col_idx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'qty'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" price"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("col_idx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'price'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  uid"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("col_idx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'uid'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" is_mine"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("is_mine"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" timestamp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("timestamp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("elif")]),t._v(" ord_type "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cancel"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ob"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cancel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uid"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("col_idx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'uid'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("elif")]),t._v(" ord_type "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"modif"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ob"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("modif"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uid"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("col_idx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'uid'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty_down"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("col_idx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'qty'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h3",{attrs:{id:"交易策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#交易策略"}},[t._v("#")]),t._v(" 交易策略")]),t._v(" "),n("blockquote",[n("p",[t._v("实现一个交易策略: 如果当前策略执行的订单量不足"),n("code",[t._v("Percentage of Volume")]),t._v(", 就下单弥补这个差距")])]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("pov_algo "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" SimplePOV"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("is_buy"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" target_pov"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lmtpx"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("np"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Inf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1e7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sweep_max"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" pov_algo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gtw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ob_time "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" end_time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    pov_algo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("eval_and_act"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gtw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    gtw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tick"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    hist_bidask"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("append"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gtw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ob"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bbid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("gtw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ob"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bask"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("gtw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ob_time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  \n"),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v("\"\"\"\n@ hist_bidask (19155 x 3)\n[[4.025, 4.0265, Timestamp('2019-05-23 09:00:31.127000')],\n [4.025, 4.0265, Timestamp('2019-05-23 09:00:31.136000')],\n ...\n [4.025, 4.0255, Timestamp('2019-05-23 09:00:31.136000')],\n [4.025, 4.0255, Timestamp('2019-05-23 09:00:31.138000')],\n\"\"\"")]),t._v(" \n")])])]),n("blockquote",[n("p",[n("img",{attrs:{src:a(710),alt:""}})])]),t._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[t._v("代码")]),t._v(" "),n("p",[t._v("<<< docs/codes/Pov.py")])])])])}),[],!1,null,null,null);s.default=e.exports},709:function(t,s,a){t.exports=a.p+"assets/img/tool_simulator-01.06cc04aa.png"},710:function(t,s,a){t.exports=a.p+"assets/img/tool_simulator-02.fee5a7a7.png"}}]);