(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{1232:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("div",{staticClass:"custom-block tip"},[n("p",[t._v("本文基于"),n("a",{attrs:{href:"https://github.com/pmorissette/bt/tree/dev",target:"_blank",rel:"noopener noreferrer"}},[t._v("bt @pmorissette"),n("OutboundLink")],1),t._v(", 理解原理和进行一点魔改")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(656)+"#center",alt:"回测结果"}})]),t._v(" "),n("h2",{attrs:{id:"获取数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#获取数据"}},[t._v("#")]),t._v(" 获取数据")]),t._v(" "),n("p",[t._v("由"),n("code",[t._v("ffn")]),t._v("的"),n("code",[t._v("get")]),t._v("接口提供")]),t._v(" "),n("Tabs",{attrs:{type:"",card:"undefined"}},[n("p",[t._v("把数据库接口写进去")]),t._v(" "),n("Tab",{attrs:{label:"参数"}},[n("ul",[n("li",[t._v("tickers (list, string, csv string): 例如 "),n("code",[t._v("'msft,c,gs,ge'")])]),t._v(" "),n("li",[t._v("provider (function): 接口函数, 默认是雅虎引擎, 我想把数据库接口写进去(参考那个csv)")]),t._v(" "),n("li",[t._v("common_dates (bool): 只保留所有ticker都有数据的日期")]),t._v(" "),n("li",[t._v("forward_fill (bool): 当"),n("code",[t._v("common_dates=False")]),t._v(", 这个设定会用第一个非NA填充缺失")]),t._v(" "),n("li",[t._v("clean_tickers (bool): 处理列标签"),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("clean_ticker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'^VIX'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" clean_ticker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'SPX Index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vix'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'spx'")]),t._v("\n")])])])]),t._v(" "),n("li",[t._v("column_names (list): 指定列标签")]),t._v(" "),n("li",[t._v("ticker_field_sep (char): 只下载部分数据, 例如 AAPL:Low 只下载AAPL的low那一列")]),t._v(" "),n("li",[t._v("mrefresh (bool): 不留缓存")]),t._v(" "),n("li",[t._v("existing (DataFrame): 把下载的数据append到已有数据, 这里数据库接口也要处理一下")]),t._v(" "),n("li",[t._v("kwargs: 例如"),n("code",[t._v("start='2010-01-01'")])])]),t._v(" "),n("p",[t._v("然后我们得到一个 "),n("code",[t._v("time x tickers")]),t._v(" 的dataframe")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("            c           gs          ge\nDate            \n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2009")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("31")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("29.361824")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("143.514740")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.605983")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2010")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("04")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30.160183")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("147.118881")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.830304")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2010")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("05")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("31.313356")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("149.719818")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.886385")]),t._v("\n")])])])]),t._v(" "),n("Tab",{attrs:{label:"补充"}},[n("ul",[n("li",[t._v("补充")])])])],1),t._v(" "),n("h2",{attrs:{id:"写策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#写策略"}},[t._v("#")]),t._v(" 写策略")]),t._v(" "),n("p",[t._v("由"),n("code",[t._v("bt")]),t._v("的"),n("code",[t._v("Strategy")]),t._v("接口提供")]),t._v(" "),n("Tabs",{attrs:{type:"",card:"undefined"}},[n("p",[t._v("想办法把强化学习策略写进去")]),t._v(" "),n("Tab",{attrs:{label:"组件"}},[n("Tabs",{attrs:{type:"",card:"undefined"}},[n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("s "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" StrategyBase"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" data\n                 c1  c2\n    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2010")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2010")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("02")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2010")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("03")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("150")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\ns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("setup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("update"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("         "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#now that we have c1/c2 price at 01.01")]),t._v("\ns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("adjust"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                           "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#inject 300 to s")]),t._v("\ns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("allocate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("250")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'c1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" c1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'c1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#use 250 to buy c1")]),t._v("\n")])])]),n("Tab",{attrs:{label:"adjust"}},[n("p",[t._v("注入资金, 但对子账户无效")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("c1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" SecurityBase"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'c1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nc2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" SecurityBase"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'c2'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ns "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" StrategyBase"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'p'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("c1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("adjust"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("capital "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" c1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" c1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("weight "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])])]),t._v(" "),n("Tab",{attrs:{label:"close"}},[n("p",[t._v("关户: 当资产价格为0或者不存在某个资产, 账户仓位清空")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" c1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("position "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("capital "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200.0")]),t._v("             "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#但是如果s['c1']里allocate money就不用从s里扣了")]),t._v("\ns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'c1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#以`c1`当前价格清仓")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" c1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("position "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("capital "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])])]),t._v(" "),n("Tab",{attrs:{label:"flatten"}},[n("p",[t._v("把所有子账户清仓")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("adjust"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("allocate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'c1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("capital "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" c1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("position "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" c1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v("\ns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("flatten"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" c1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" c1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("position "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("capital "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),t._v("\n")])])])])],1)],1),t._v(" "),n("Tab",{attrs:{label:"参数"}},[n("ul",[n("li",[t._v("name: sma10 - 策略名称")]),t._v(" "),n("li",[t._v("algos (list): 对获取数据的一系列处理, 无法并行, 只要其中一条算法返回False, 策略停止")]),t._v(" "),n("li",[t._v("parent = root = "),n("code",[t._v("<Strategy sma10>")])]),t._v(" "),n("li",[t._v("children(dict, list): 假设资产组合为"),n("code",[t._v("ibm, tsla, msft")]),t._v(", 那么策略就会有"),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("S"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("children\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ibm'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("SecurityBase sma10"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("ibm"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tsla'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("SecurityBase sma10"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("tsla"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'msft'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("SecurityBase sma10"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("msft"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),n("li",[t._v("now (datetime): 遍历获取数据使用的指针, 例如"),n("code",[t._v("Timestamp('2021-01-15 00:00:00')")])]),t._v(" "),n("li",[t._v("prices (TimeSeries): Security prices. ?? "),n("code",[t._v("self.price")]),t._v("指向最近价格")]),t._v(" "),n("li",[t._v("use_integer_positions (bool): 是否要求所有资产的持仓位必须是整数, 默认是, 但可以考虑fractional trading")]),t._v(" "),n("li",[t._v("temp: {'selected': ['gs', 'ge'], 'weights': {'gs': 0.5, 'ge': 0.5}} 临时存储")]),t._v(" "),n("li",[t._v("perm (dict): Permanent data used to pass info from one algo to another. Not cleared on each pass.")]),t._v(" "),n("li",[t._v("data: 统计策略效益 ??为啥多个资产, 就一个价格?"),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("                 price         value        cash  fees\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("235.157729")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.351577e+06")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("215.803660")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("239.563307")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.395633e+06")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("276.344126")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("229.993571")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.299936e+06")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("116.473505")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v("\n")])])])]),t._v(" "),n("li",[t._v("positions:"),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("                 ge       c     gs\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("67749.0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("11723.0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2587.0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("68485.0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("11571.0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2593.0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("101497.0")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3820.0")]),t._v("\n")])])])])])]),t._v(" "),n("Tab",{attrs:{label:"评估"}},[n("p",[t._v("基于"),n("code",[t._v("ffn.core.PerformanceStats")]),t._v("接口")]),t._v(" "),n("ul",[n("li",[t._v("prices(series): 从start-date到end-date每天一个")]),t._v(" "),n("li",[t._v("rf(float or series): risk-free rate, 可以设置也可以是一个pd.series")]),t._v(" "),n("li",[t._v("float: daily_mean, daily_vol, daily,sharpe, daily_sortino, cagr(compound annual growth rate)")]),t._v(" "),n("li",[t._v("float: best_day, worst_day: 回报的最大/最小值; total_return: 总回报")]),t._v(" "),n("li",[t._v("drawdown (series): 从最近历史最高点价格往下的幅度, "),n("code",[t._v("drawdown_details")]),t._v("刻画的更仔细")]),t._v(" "),n("li",[t._v("float: daily_skew, daily_kurt")]),t._v(" "),n("li",[t._v("series: monthly_returns, yearly_returns")]),t._v(" "),n("li",[t._v("return_table: 显示每年每个月的回报率"),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("        Jan         Feb         Mar         Apr         May         Jun         Jul         Aug         Sep         Oct         Nov         Dec         YTD\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2009")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000000")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000000")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000000")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000000")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000000")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000000")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000000")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000000")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000000")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000000")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000000")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000000")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000000")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2010")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.040719")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.014114")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.138134")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.063934")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.039809")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.141698")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.056001")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.025762")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.002530")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.050998")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000068")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.119172")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.007318")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2011")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.007785")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.002383")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.042651")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.006071")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.027695")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.022592")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.039414")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.036690")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.171185")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.155409")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.152653")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.083666")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.228694")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2012")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.117055")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.026763")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.025129")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.085272")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.031195")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.061719")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.007211")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.050128")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.125111")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.040017")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.030030")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.023678")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.340039")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2013")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.094995")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.001551")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.007742")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.010723")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.083662")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.088852")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.062815")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.023802")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.036344")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.012230")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.057299")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.011057")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.283221")]),t._v("\n")])])])])])]),t._v(" "),n("Tab",{attrs:{label:"算法"}},[n("p",[n("code",[t._v("AlgoStack(*algos)(self)")]),t._v(" >> 前者是在回测建立时, 依序放进栈里的算法，后者是策略本身")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stack"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("algos\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("bt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("algos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SelectWhere "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("object")]),t._v(" at "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x0000020527B32310")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("bt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("algos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("WeighEqually "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("object")]),t._v(" at "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x0000020527B32400")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("bt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("algos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Rebalance "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("object")]),t._v(" at "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x0000020527B32A30")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("Tabs",{attrs:{type:"",card:"undefined"}},[n("Tab",{attrs:{label:"SelectWhere"}},[n("p",[n("code",[t._v("signal")]),t._v("是算法创建时根据数据得到的信号(true/false)")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br")]),n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("             ibm  tsla   msft\nDate\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("\n")])])])]),t._v(" "),n("Tab",{attrs:{label:"WeighEqually"}},[n("p",[t._v("对上一步中被选中的股票进行权重分配")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("target"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("temp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'selected'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tsla'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'msft'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\ntarget"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("temp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'weights'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tsla'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'msft'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])],1)],1)],1),t._v(" "),n("h2",{attrs:{id:"做回测"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#做回测"}},[t._v("#")]),t._v(" 做回测")]),t._v(" "),n("p",[t._v("由"),n("code",[t._v("bt")]),t._v("的"),n("code",[t._v("Backtest")]),t._v("接口提供, 这个是策略的返回对象, 参数主要是单一策略和对象数据")]),t._v(" "),n("Tabs",{attrs:{type:"",card:"undefined"}},[n("Tab",{attrs:{label:"参数"}},[n("ul",[n("li",[t._v("initial_capital (float): 起始资金(不破产), 默认1000000")]),t._v(" "),n("li",[t._v("commissions (fn(quantity, price)): 中介费, 例如 "),n("code",[t._v("commissions=lambda q, p: max(1, abs(q) * 0.01)")])]),t._v(" "),n("li",[t._v("progress_bar (Bool): 是否显示运行进度\n"),n("br"),t._v("属性")]),t._v(" "),n("li",[t._v("weights: 策略下不同资产的持有净值(不是position, 是value)"),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("          sma10   sma10"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("ge     sma10"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("c    sma10"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("gs\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.333332")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.333308")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.333268")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.333329")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.333321")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.333234")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.499997")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000000")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.499952")]),t._v("\n")])])])]),t._v(" "),n("li",[t._v("positions: 不同资产的position"),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("                  ge      c     gs\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("67749.0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("11723.0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2587.0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("68485.0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("11571.0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2593.0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("101497.0")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3820.0")]),t._v("\n")])])])]),t._v(" "),n("li",[t._v("security weights:"),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("                  ge           c          gs\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.333332")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.333308")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.333268")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.333329")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.333321")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.333234")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.499997")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000000")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.499952")]),t._v("\n")])])])]),t._v(" "),n("li",[t._v("herfindahl_index: HHI is defined as a sum of squared weights of securities in a portfolio "),n("code",[t._v("(weights ** 2).sum(axis=1)")])]),t._v(" "),n("li",[t._v("turnover: Turnover is defined as the lesser of positive or negative outlays divided by strategy.values")])])]),t._v(" "),n("Tab",{attrs:{label:"步骤"}},[n("ol",[n("li",[t._v("确定策略和数据的映射"),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 例如 long_only_ew 策略")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("long_only_ew")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tickers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" start"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2019-01-01'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'long_only_ew'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    s "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Strategy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("bt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("algos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RunOnce"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                           bt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("algos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SelectAll"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                           bt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("algos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("WeighEqually"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                           bt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("algos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Rebalance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    data "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tickers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" start"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" bt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Backtest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),n("li",[t._v("执行策略")])]),t._v(" "),n("Tabs",{attrs:{type:"",card:"undefined"}},[n("Tab",{attrs:{label:"backtest.run"}},[n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("has_run"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n    self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("has_run "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("\n    self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("strategy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("setup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("strategy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("adjust"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("initial_capital"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("strategy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("update"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" dt "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("strategy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("update"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("strategy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bankrupt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("strategy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("strategy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("update"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stats "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("strategy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prices"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("calc_perf_stats"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),n("Tab",{attrs:{label:"strategy.setup"}},[n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setup")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" universe"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_prices "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" prices "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" universe"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DataFrame"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("index"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("universe"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                 columns"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'value'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'position'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                 data"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_prices_set "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("\n    self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_values "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'value'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_positions "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'position'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),n("ul",[n("li",[t._v("cash, fees, funiverse, prices")])])]),t._v(" "),n("Tab",{attrs:{label:"strategy.adjust"}},[n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("adjust")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" amount"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" update"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" flow"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fee"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_capital "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" amount\n    self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_last_fee "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" fee\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" flow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_net_flows "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" amount "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#example includes a capital injection every month")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" update"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stale "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#indicate data is now stale and need update before access")]),t._v("\n")])])]),n("ul",[n("li",[t._v("stale, net_flow and capital")])])]),t._v(" "),n("Tab",{attrs:{label:"strategy.update"}},[n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" date"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" inow"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stale "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#now we upate the stale data to enable its access")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n    1. update data if now.value changed, or now is different than date\n    2. update all children data if parent needs to update\n    3. \n    """')]),t._v("\n")])])]),n("ul",[n("li",[t._v("on date/inow index: update price, cash, value and all udpates can be seen on "),n("code",[t._v("strategy.data")]),t._v(", stale now goes back to False (meaning already updated) and update now to be current timestamp (i.e., date).")])])]),t._v(" "),n("Tab",{attrs:{label:"strategy.run"}},[n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("temp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#clear out tmp data")]),t._v("\n    self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stack"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#run algo stack")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" c "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_childrenv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        c"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#run children ")]),t._v("\n")])])])])],1)],1)],1)],1)}),[],!1,null,null,null);s.default=e.exports},656:function(t,s,a){t.exports=a.p+"assets/img/bt-01.72a7a085.png"}}]);